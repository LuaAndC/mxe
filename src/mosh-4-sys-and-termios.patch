From c99474ed3f6835eec9abc326645802f723c63d98 Mon Sep 17 00:00:00 2001
From: Boris Nagaev <bnagaev@gmail.com>
Date: Sun, 27 Sep 2015 16:15:34 +0100
Subject: [PATCH] sys/ioctl.h,resource.h,socket.h, termios.h

Include ncurses/ncurses_mingw.h instead of termios.h
---
 configure                   | 4 ++--
 src/crypto/crypto.cc        | 3 ++-
 src/examples/benchmark.cc   | 3 ++-
 src/examples/ntester.cc     | 2 +-
 src/examples/parse.cc       | 2 +-
 src/examples/termemu.cc     | 5 +++--
 src/frontend/mosh-server.cc | 4 +---
 src/frontend/stmclient.cc   | 3 ++-
 src/frontend/stmclient.h    | 5 +++--
 src/network/network.cc      | 1 -
 src/network/network.h       | 1 -
 src/util/pty_compat.cc      | 5 +++--
 12 files changed, 20 insertions(+), 18 deletions(-)

diff --git a/configure b/configure
index a14107c..3603527 100755
--- a/configure
+++ b/configure
@@ -6544,7 +6544,7 @@ fi
 done
 
 
-for ac_header in fcntl.h plibc/langinfo.h limits.h locale.h winsock2.h ws2tcpip.h stddef.h stdint.h inttypes.h stdlib.h string.h sys/ioctl.h sys/resource.h sys/socket.h sys/stat.h sys/time.h termios.h unistd.h wchar.h wctype.h
+for ac_header in fcntl.h plibc/langinfo.h limits.h locale.h winsock2.h ws2tcpip.h stddef.h stdint.h inttypes.h stdlib.h string.h sys/stat.h sys/time.h unistd.h wchar.h wctype.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
@@ -9059,7 +9059,7 @@ $as_echo "$as_me: WARNING: C library doesn't advertise wchar_t is Unicode (OS X
 fi
 
 
-ac_fn_c_check_decl "$LINENO" "IUTF8" "ac_cv_have_decl_IUTF8" "#include <termios.h>
+ac_fn_c_check_decl "$LINENO" "IUTF8" "ac_cv_have_decl_IUTF8" "#include <ncurses/ncurses_mingw.h>
 "
 if test "x$ac_cv_have_decl_IUTF8" = xyes; then :
 
diff --git a/src/crypto/crypto.cc b/src/crypto/crypto.cc
index f7e9fb5..bcf5cd9 100644
--- a/src/crypto/crypto.cc
+++ b/src/crypto/crypto.cc
@@ -35,7 +35,8 @@
 #include <errno.h>
 #include <stdlib.h>
 #include <assert.h>
-#include <sys/resource.h>
+#include <winsock2.h>
+#include <ws2tcpip.h>
 #include <fstream>
 
 #include "byteorder.h"
diff --git a/src/examples/benchmark.cc b/src/examples/benchmark.cc
index 2418ddd..3bbde66 100644
--- a/src/examples/benchmark.cc
+++ b/src/examples/benchmark.cc
@@ -38,7 +38,8 @@
 #include <unistd.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <sys/ioctl.h>
+#include <winsock2.h>
+#include <ws2tcpip.h>
 #include <sys/types.h>
 #include <pwd.h>
 #include <signal.h>
diff --git a/src/examples/ntester.cc b/src/examples/ntester.cc
index 4fc7404..f5194cf 100644
--- a/src/examples/ntester.cc
+++ b/src/examples/ntester.cc
@@ -30,7 +30,7 @@
     also delete it here.
 */
 
-#include <termios.h>
+#include <ncurses/ncurses_mingw.h>
 #include <unistd.h>
 
 #include "user.h"
diff --git a/src/examples/parse.cc b/src/examples/parse.cc
index 93fabf4..b34e2ad 100644
--- a/src/examples/parse.cc
+++ b/src/examples/parse.cc
@@ -44,7 +44,7 @@
 #include <wctype.h>
 #include <iostream>
 #include <typeinfo>
-#include <termios.h>
+#include <ncurses/ncurses_mingw.h>
 
 #if HAVE_PTY_H
 #include <pty.h>
diff --git a/src/examples/termemu.cc b/src/examples/termemu.cc
index cedf90a..49813ef 100644
--- a/src/examples/termemu.cc
+++ b/src/examples/termemu.cc
@@ -44,10 +44,11 @@
 #include <wctype.h>
 #include <iostream>
 #include <typeinfo>
-#include <sys/ioctl.h>
+#include <winsock2.h>
+#include <ws2tcpip.h>
 #include <sys/stat.h>
 #include <fcntl.h>
-#include <termios.h>
+#include <ncurses/ncurses_mingw.h>
 #include <sys/types.h>
 #include <pwd.h>
 #include <sys/time.h>
diff --git a/src/frontend/mosh-server.cc b/src/frontend/mosh-server.cc
index a264003..510a13d 100644
--- a/src/frontend/mosh-server.cc
+++ b/src/frontend/mosh-server.cc
@@ -37,12 +37,11 @@
 #include <locale.h>
 #include <string.h>
 #include <sstream>
-#include <termios.h>
+#include <ncurses/ncurses_mingw.h>
 #include <unistd.h>
 #include <fcntl.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <sys/ioctl.h>
 #include <sys/types.h>
 #include <pwd.h>
 #include <typeinfo>
@@ -50,7 +49,6 @@
 #ifdef HAVE_UTEMPTER
 #include <utempter.h>
 #endif
-#include <sys/socket.h>
 #include <winsock2.h>
 #include <ws2tcpip.h>
 #include <time.h>
diff --git a/src/frontend/stmclient.cc b/src/frontend/stmclient.cc
index 9e4d916..167e0ba 100644
--- a/src/frontend/stmclient.cc
+++ b/src/frontend/stmclient.cc
@@ -38,7 +38,8 @@
 #include <unistd.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <sys/ioctl.h>
+#include <winsock2.h>
+#include <ws2tcpip.h>
 #include <sys/types.h>
 #include <pwd.h>
 #include <signal.h>
diff --git a/src/frontend/stmclient.h b/src/frontend/stmclient.h
index 1707f18..b551783 100644
--- a/src/frontend/stmclient.h
+++ b/src/frontend/stmclient.h
@@ -33,8 +33,9 @@
 #ifndef STM_CLIENT_HPP
 #define STM_CLIENT_HPP
 
-#include <sys/ioctl.h>
-#include <termios.h>
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#include <ncurses_mingw.h>
 #include <string>
 
 #include "completeterminal.h"
diff --git a/src/network/network.cc b/src/network/network.cc
index 7cfb309..6d9129c 100644
--- a/src/network/network.cc
+++ b/src/network/network.cc
@@ -33,7 +33,6 @@
 #include "config.h"
 
 #include <sys/types.h>
-#include <sys/socket.h>
 #ifdef HAVE_SYS_UIO_H
 #include <sys/uio.h>
 #endif
diff --git a/src/network/network.h b/src/network/network.h
index d80293b..2c96520 100644
--- a/src/network/network.h
+++ b/src/network/network.h
@@ -35,7 +35,6 @@
 
 #include <stdint.h>
 #include <deque>
-#include <sys/socket.h>
 #include <winsock2.h>
 #include <ws2tcpip.h>
 #include <string>
diff --git a/src/util/pty_compat.cc b/src/util/pty_compat.cc
index c723326..e251f32 100644
--- a/src/util/pty_compat.cc
+++ b/src/util/pty_compat.cc
@@ -38,9 +38,10 @@
 #include <string.h>
 #include <unistd.h>
 #include <fcntl.h>
-#include <sys/ioctl.h>
+#include <winsock2.h>
+#include <ws2tcpip.h>
 #include <sys/stropts.h>
-#include <termios.h>
+#include <ncurses/ncurses_mingw.h>
 
 #include "pty_compat.h"
 
-- 
2.1.4

